<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zcash Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fonts: Inter for UI, JetBrains Mono for Data -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        zgold: '#F5B700',
                        zgoldDim: 'rgba(245, 183, 0, 0.15)',
                        void: '#030609',
                        surface: '#0B101A',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        shimmer: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
      /* --- BASE ATMOSPHERE --- */
      body {
          background-color: #030609;
          background-image: 
            radial-gradient(circle at 50% 0%, #1a202c 0%, transparent 70%),
            radial-gradient(circle at 80% 80%, rgba(245, 183, 0, 0.03) 0%, transparent 40%);
          color: #e2e8f0;
          overflow: hidden; 
      }

      /* Subtle Noise Texture */
      body::before {
          content: "";
          position: absolute;
          top: 0; left: 0; width: 100%; height: 100%;
          background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
          pointer-events: none;
          z-index: 50;
          opacity: 0.4;
      }

      /* --- GLASSMORPHISM --- */
      .glass-panel {
        background: rgba(11, 16, 26, 0.6); 
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.03);
        border-top: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }

      /* Interactive Cards */
      .metric-card {
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }
      .metric-card:hover {
        transform: translateY(-2px);
        background: rgba(11, 16, 26, 0.8);
        box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.8);
        border-color: rgba(245, 183, 0, 0.3);
      }
      .metric-card:hover .icon-gold {
         text-shadow: 0 0 15px rgba(245, 183, 0, 0.6);
         color: #F5B700;
         opacity: 1;
      }
      .resource-card:hover .resource-arrow {
          transform: translateX(4px) translateY(-4px);
          color: #F5B700;
      }

      /* --- TYPOGRAPHY --- */
      .mono-num {
        font-family: 'JetBrains Mono', monospace;
        font-variant-numeric: tabular-nums;
        letter-spacing: -0.05em;
      }
      .text-glow { text-shadow: 0 0 20px rgba(245, 183, 0, 0.3); }
      .label-tech {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #64748b;
        font-weight: 700;
      }

      /* --- TICKER TAPE --- */
      .ticker-strip {
        background: linear-gradient(90deg, rgba(11,16,26,0) 0%, rgba(11,16,26,0.8) 10%, rgba(11,16,26,0.8) 90%, rgba(11,16,26,0) 100%);
        border-top: 1px solid rgba(255,255,255,0.05);
        border-bottom: 1px solid rgba(255,255,255,0.05);
      }
      .ticker-item { position: relative; }
      .ticker-item::after {
        content: ''; position: absolute; right: 0; top: 20%; height: 60%; width: 1px;
        background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.1), transparent);
      }
      .ticker-item:last-child::after { display: none; }

      /* --- NAVIGATION --- */
      .nav-item {
        position: relative; transition: all 0.3s ease; border-radius: 0.5rem; color: #94a3b8;
      }
      .nav-item:hover { color: #f1f5f9; background: rgba(255,255,255,0.03); }
      .nav-item.active { color: #F5B700; background: rgba(245, 183, 0, 0.08); }
      .nav-item.active::before {
        content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
        height: 20px; width: 3px; background: #F5B700; border-radius: 0 4px 4px 0;
        box-shadow: 0 0 10px #F5B700;
      }

      /* --- UTILS --- */
      .chart-container-main { position: relative; width: 100%; height: 45vh; max-height: 500px; }
      .chart-container-spark { position: relative; width: 100%; height: 100px; }
      .hidden-section { display: none; }
      
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

      /* Animations */
      @keyframes flashGreen { 0% { color: #4ade80; text-shadow: 0 0 10px rgba(74, 222, 128, 0.5); } 100% { color: #ffffff; text-shadow: none; } }
      @keyframes flashRed { 0% { color: #f87171; text-shadow: 0 0 10px rgba(248, 113, 113, 0.5); } 100% { color: #ffffff; text-shadow: none; } }
      .flash-up { animation: flashGreen 0.8s ease-out; }
      .flash-down { animation: flashRed 0.8s ease-out; }
      
      .fade-in { animation: fadeIn 0.4s ease-out forwards; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>
    <div class="flex h-screen z-10 relative">
        
        <!-- SIDEBAR -->
        <nav id="sidebar" class="w-72 glass-panel border-r-0 border-l-0 border-b-0 fixed md:relative h-full z-30 transform -translate-x-full md:translate-x-0 transition-transform duration-300 flex flex-col">
            <!-- Logo Area -->
            <div class="flex items-center px-8 h-24 border-b border-white/5 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-zgold to-transparent opacity-50"></div>
                <div class="w-10 h-10 rounded-full bg-zgold flex items-center justify-center text-void font-bold text-xl mr-4 shadow-[0_0_25px_rgba(245,183,0,0.4)] relative z-10">Z</div>
                <div>
                    <h1 class="text-xl font-bold text-white tracking-tight font-sans">Zcash <span class="text-zgold">Terminal</span></h1>
                </div>
            </div>
            
            <!-- Nav Links -->
            <div class="p-6 space-y-8 flex-1 overflow-y-auto">
                <div>
                    <p class="text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-4 pl-2">Analytics</p>
                    <ul class="space-y-2">
                        <li class="nav-item active p-3 pl-4 rounded-lg flex items-center space-x-4 cursor-pointer" data-target="view-price">
                            <span class="text-lg">üìä</span> <span class="font-medium text-sm tracking-wide">Market Overview</span>
                        </li>
                        <li class="nav-item p-3 pl-4 rounded-lg flex items-center space-x-4 cursor-pointer" data-target="view-shielded">
                            <span class="text-lg">üõ°Ô∏è</span> <span class="font-medium text-sm tracking-wide">Privacy Network</span>
                        </li>
                    </ul>
                </div>

                <div>
                    <p class="text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-4 pl-2">Resources</p>
                    <ul class="space-y-2">
                        <li class="nav-item p-3 pl-4 rounded-lg flex items-center space-x-4 cursor-pointer" data-target="view-education">
                            <span class="text-lg">üéì</span> <span class="font-medium text-sm tracking-wide">Education</span>
                        </li>
                    </ul>
                </div>
                
                <!-- Mini Status Card -->
                <div class="mt-auto glass-panel rounded-xl p-4 border border-white/5 relative overflow-hidden group">
                     <div class="absolute -right-4 -top-4 w-16 h-16 bg-green-500/10 rounded-full blur-xl group-hover:bg-green-500/20 transition-all"></div>
                     <div class="flex items-center space-x-2 mb-2">
                        <span class="relative flex h-2 w-2">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500 shadow-[0_0_10px_rgba(74,222,128,0.6)]"></span>
                        </span>
                        <span class="text-[10px] font-bold text-green-400 uppercase tracking-widest">Network Live</span>
                     </div>
                     <div class="flex justify-between items-end">
                         <span class="text-xs text-slate-400">Height</span>
                         <span class="font-mono text-sm text-white" id="sidebar-block">...</span>
                     </div>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="p-6 border-t border-white/5">
                <button id="refresh-btn" class="group w-full relative overflow-hidden bg-white/5 hover:bg-zgold text-slate-300 hover:text-void font-bold py-3 px-4 rounded-lg transition-all duration-300 flex justify-center items-center gap-3 text-xs uppercase tracking-wider border border-white/10 hover:border-zgold shadow-lg">
                    <span class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-[shimmer_1s_infinite]"></span>
                    <span id="refresh-icon" class="text-base">‚Üª</span> Sync Data
                </button>
                <div class="text-center mt-3 flex items-center justify-center gap-2">
                    <div class="w-1.5 h-1.5 rounded-full bg-zgold animate-pulse"></div>
                    <span class="text-[10px] text-slate-500 font-mono">Binance Feed: Active</span>
                </div>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col h-full overflow-hidden relative bg-transparent">
            
            <!-- Top Bar Mobile -->
            <header class="md:hidden flex items-center justify-between p-4 glass-panel z-20 border-b border-white/5">
                <span class="text-lg font-bold text-white font-sans">Zcash <span class="text-zgold">Terminal</span></span>
                <button id="menu-toggle" class="text-white p-2">‚ò∞</button>
            </header>

            <div class="flex-1 overflow-y-auto p-6 lg:p-10 scroll-smooth">
                
                <div id="error-toast" class="hidden mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-lg text-red-200 text-sm flex items-center gap-3 backdrop-blur-md">
                    <span class="text-red-400">‚ö†</span> <span id="error-msg">Error</span>
                </div>

                <!-- VIEW 1: OVERVIEW -->
                <section id="view-price" class="fade-in">
                    
                    <!-- Big Price Display -->
                    <div class="flex flex-col md:flex-row justify-between items-end mb-8">
                        <div>
                            <h2 class="text-4xl font-bold text-white mb-2 tracking-tight font-sans">Market <span class="text-slate-500 font-light">Overview</span></h2>
                            <p class="text-slate-400 text-sm font-medium flex items-center gap-2">
                                <span class="px-2 py-0.5 rounded bg-white/5 border border-white/5 text-[10px] uppercase tracking-wider text-slate-300">ZEC / USDT</span>
                                <span class="text-slate-500">‚Ä¢</span>
                                <span class="text-slate-500">Live Feed</span>
                            </p>
                        </div>
                        <div class="text-right mt-6 md:mt-0 relative">
                            <div class="absolute right-0 top-1/2 -translate-y-1/2 w-32 h-32 bg-zgold opacity-5 blur-[60px] rounded-full pointer-events-none"></div>
                            <div class="text-6xl md:text-7xl font-bold text-white tracking-tighter mono-num transition-colors duration-300" id="live-price">---</div>
                            <div class="flex justify-end items-center gap-3 mt-2">
                                <div class="font-mono text-lg font-bold px-3 py-1 rounded bg-black/30 border border-white/5" id="live-change">--%</div>
                            </div>
                        </div>
                    </div>

                    <!-- TICKER STRIP -->
                    <div class="w-full overflow-x-auto mb-10 pb-4 -mx-2 px-2">
                        <div class="glass-panel rounded-xl p-0 min-w-[900px] flex justify-between items-stretch ticker-strip">
                            <div class="ticker-item flex-1 py-4"><div class="ticker-val mono-num" id="t-high">...</div><div class="ticker-label">24h High</div></div>
                            <div class="ticker-item flex-1 py-4"><div class="ticker-val mono-num" id="t-low">...</div><div class="ticker-label">24h Low</div></div>
                            <div class="ticker-item flex-1 py-4"><div class="ticker-val mono-num" id="t-vol-zec">...</div><div class="ticker-label">Vol (ZEC)</div></div>
                            <div class="ticker-item flex-1 py-4"><div class="ticker-val mono-num" id="t-vol-usd">...</div><div class="ticker-label">Vol (USD)</div></div>
                            <div class="ticker-item flex-1 py-4"><div class="ticker-val mono-num text-slate-300" id="t-ath">...</div><div class="ticker-label">ATH</div></div>
                            <div class="ticker-item flex-1 py-4"><div class="ticker-val mono-num text-zgold text-glow" id="t-mcap">...</div><div class="ticker-label">Market Cap</div></div>
                            <div class="ticker-item flex-1 py-4"><div class="ticker-val mono-num text-white" id="t-rank">...</div><div class="ticker-label">Rank</div></div>
                            <div class="ticker-item flex-1 py-4"><div class="ticker-val mono-num text-white" id="t-privacy">...</div><div class="ticker-label">Shielded %</div></div>
                        </div>
                    </div>

                    <!-- CHART SECTION -->
                    <div class="glass-panel rounded-2xl p-1 mb-10 relative group">
                        <div class="p-4 border-b border-white/5 flex justify-between items-center bg-black/20 rounded-t-2xl">
                            <div class="flex items-center space-x-3">
                                <div class="w-2 h-2 rounded-full bg-zgold animate-pulse"></div>
                                <span class="text-xs font-bold text-slate-300 uppercase tracking-widest">Price Action</span>
                            </div>
                            <span class="text-[10px] text-slate-600 uppercase tracking-wider font-bold">1Y Timeframe ‚Ä¢ CoinGecko API</span>
                        </div>
                        <div class="p-4 chart-container-main relative z-10">
                            <canvas id="mainChart"></canvas>
                        </div>
                        <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-zgoldDim to-transparent opacity-5 pointer-events-none"></div>
                    </div>

                    <!-- DATA GRID -->
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                        <!-- Blockchain -->
                        <div class="glass-panel metric-card p-6 rounded-2xl">
                            <div class="flex justify-between items-start mb-4 border-b border-white/5 pb-2">
                                <h3 class="text-sm font-bold text-white uppercase tracking-widest">Blockchain</h3>
                                <span class="text-lg icon-gold opacity-50 transition-all duration-300">üîó</span>
                            </div>
                            <div class="space-y-0">
                                <div class="data-row"><span class="label-tech">Block Height</span><span class="data-val mono-num text-white" id="block-height">...</span></div>
                                <div class="data-row"><span class="label-tech">Avg Block Time</span><span class="data-val mono-num" id="block-speed">~75s</span></div>
                                <div class="data-row"><span class="label-tech">Difficulty</span><span class="data-val mono-num text-slate-400" id="difficulty">...</span></div>
                                <div class="data-row"><span class="label-tech">Blocks (24h)</span><span class="data-val mono-num" id="blocks-24h">...</span></div>
                            </div>
                        </div>
                        <!-- Mining -->
                        <div class="glass-panel metric-card p-6 rounded-2xl">
                             <div class="flex justify-between items-start mb-4 border-b border-white/5 pb-2">
                                <h3 class="text-sm font-bold text-white uppercase tracking-widest">Mining</h3>
                                <span class="text-lg icon-gold opacity-50 transition-all duration-300">‚õèÔ∏è</span>
                            </div>
                            <div class="space-y-0">
                                <div class="data-row"><span class="label-tech">Hashrate</span><span class="data-val mono-num text-white" id="hashrate">...</span></div>
                                <div class="data-row"><span class="label-tech">Reward / Block</span><span class="data-val mono-num text-zgold font-bold">1.5625 ZEC</span></div>
                                <div class="data-row"><span class="label-tech">Reward (USD)</span><span class="data-val mono-num text-green-400" id="reward-usd">...</span></div>
                            </div>
                        </div>
                        <!-- Supply -->
                        <div class="glass-panel metric-card p-6 rounded-2xl">
                             <div class="flex justify-between items-start mb-4 border-b border-white/5 pb-2">
                                <h3 class="text-sm font-bold text-white uppercase tracking-widest">Supply</h3>
                                <span class="text-lg icon-gold opacity-50 transition-all duration-300">ü™ô</span>
                            </div>
                            <div class="space-y-0">
                                <div class="data-row"><span class="label-tech">Circulating</span><span class="data-val mono-num text-white" id="circulating-supply">...</span></div>
                                <div class="data-row"><span class="label-tech">Max Supply</span><span class="data-val mono-num text-slate-400">21,000,000</span></div>
                                <div class="data-row"><span class="label-tech">Issued %</span><span class="data-val mono-num text-zgold" id="percentage-mined">...</span></div>
                                <div class="data-row"><span class="label-tech">Remaining</span><span class="data-val mono-num" id="issuance-remaining">...</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- VIEW 2: SHIELDED -->
                <section id="view-shielded" class="hidden-section fade-in">
                    <div class="mb-8 border-l-4 border-zgold pl-6">
                         <h2 class="text-4xl font-bold text-white mb-2 tracking-tight font-sans">Shielded <span class="text-slate-500 font-light">Network</span></h2>
                         <p class="text-slate-400 text-sm">Adoption metrics for Zero-Knowledge pools.</p>
                    </div>
                    <div class="glass-panel rounded-2xl p-8 relative overflow-hidden">
                        <div class="absolute right-0 top-0 w-64 h-64 bg-zgold opacity-5 blur-[80px] rounded-full pointer-events-none"></div>
                        <h3 class="text-lg font-bold text-white mb-6 uppercase tracking-widest border-b border-white/5 pb-4">Shielded Pool Growth</h3>
                        <div class="chart-container-spark h-72 relative z-10">
                            <canvas id="shieldedChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- VIEW 3: EDUCATION -->
                <section id="view-education" class="hidden-section fade-in">
                    <div class="mb-10 border-l-4 border-zgold pl-6">
                        <h2 class="text-4xl font-bold text-white mb-2 tracking-tight font-sans">Knowledge <span class="text-slate-500 font-light">Base</span></h2>
                        <p class="text-slate-400 text-sm">Understanding Privacy Money.</p>
                   </div>

                   <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                       <div class="glass-panel metric-card p-8 rounded-2xl">
                           <div class="text-4xl mb-4">üõ°Ô∏è</div>
                           <h3 class="text-xl font-bold text-white mb-3">Why Fungibility Matters</h3>
                           <p class="text-slate-400 leading-relaxed text-sm">
                               In transparent chains, coins can be "tainted" by their history. Zcash privacy ensures 1 ZEC always equals 1 ZEC, regardless of past transactions, making it true digital cash.
                           </p>
                       </div>
                       <div class="glass-panel metric-card p-8 rounded-2xl">
                            <div class="text-4xl mb-4">üîí</div>
                            <h3 class="text-xl font-bold text-white mb-3">Personal Sovereignty</h3>
                            <p class="text-slate-400 leading-relaxed text-sm">
                                Financial data is personal. Zcash protects your balance and transaction history from prying eyes, advertisers, and criminals using Zero-Knowledge Proofs.
                            </p>
                        </div>
                   </div>

                   <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-6 pl-2">Essential Ecosystem</h3>
                   <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <a href="https://z.cash" target="_blank" class="glass-panel metric-card resource-card p-6 rounded-xl block group">
                            <div class="flex justify-between items-start mb-3">
                                <span class="font-bold text-white group-hover:text-zgold transition-colors text-lg">Z.cash</span>
                                <span class="text-slate-500 resource-arrow transition-transform duration-300">‚Üó</span>
                            </div>
                            <p class="text-xs text-slate-400">Official Website & Wallets</p>
                        </a>
                        <a href="https://zechub.wiki" target="_blank" class="glass-panel metric-card resource-card p-6 rounded-xl block group">
                            <div class="flex justify-between items-start mb-3">
                                <span class="font-bold text-white group-hover:text-zgold transition-colors text-lg">ZecHub</span>
                                <span class="text-slate-500 resource-arrow transition-transform duration-300">‚Üó</span>
                            </div>
                            <p class="text-xs text-slate-400">Community Wiki & Guides</p>
                        </a>
                        <a href="https://free2z.cash" target="_blank" class="glass-panel metric-card resource-card p-6 rounded-xl block group">
                            <div class="flex justify-between items-start mb-3">
                                <span class="font-bold text-white group-hover:text-zgold transition-colors text-lg">Free2Z</span>
                                <span class="text-slate-500 resource-arrow transition-transform duration-300">‚Üó</span>
                            </div>
                            <p class="text-xs text-slate-400">Zcash Creator Platform</p>
                        </a>
                         <a href="https://zcashblockexplorer.com" target="_blank" class="glass-panel metric-card resource-card p-6 rounded-xl block group">
                            <div class="flex justify-between items-start mb-3">
                                <span class="font-bold text-white group-hover:text-zgold transition-colors text-lg">Block Explorer</span>
                                <span class="text-slate-500 resource-arrow transition-transform duration-300">‚Üó</span>
                            </div>
                            <p class="text-xs text-slate-400">View Blocks & Hashrate</p>
                        </a>
                   </div>
                </section>

            </div>
        </main>
    </div>

    <script>
        // --- CONFIG ---
        const BINANCE_WS = "wss://stream.binance.com:9443/ws/zecusdt@ticker";
        const API_CG = "https://api.coingecko.com/api/v3/coins/zcash?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false";
        const API_CG_CHART = "https://api.coingecko.com/api/v3/coins/zcash/market_chart?vs_currency=usd&days=365";
        const API_BC = "https://api.blockchair.com/zcash/stats";

        // --- STATE ---
        let currentPrice = 0;
        let currentVolUsd = 0;
        let mainChartInstance = null;
        let shieldedChartInstance = null;

        // --- FORMATTERS ---
        const formatUSD = (num) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(num);
        const formatCompact = (num) => new Intl.NumberFormat('en-US', { notation: "compact", compactDisplay: "short", maximumFractionDigits: 2 }).format(num);
        const formatNum = (num) => new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(num);

        // --- WEBSOCKET (Real-time) ---
        function initWebSocket() {
            const ws = new WebSocket(BINANCE_WS);
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const newPrice = parseFloat(data.c);
                const change = parseFloat(data.P);

                const priceEl = document.getElementById('live-price');
                const changeEl = document.getElementById('live-change');

                if(newPrice > currentPrice) {
                    priceEl.classList.remove('flash-down'); priceEl.classList.add('flash-up');
                    priceEl.style.color = '#4ade80'; 
                } else if (newPrice < currentPrice) {
                    priceEl.classList.remove('flash-up'); priceEl.classList.add('flash-down');
                    priceEl.style.color = '#f87171'; 
                }
                
                setTimeout(() => { 
                    priceEl.classList.remove('flash-up', 'flash-down');
                    priceEl.style.color = 'white'; 
                }, 800);

                priceEl.innerText = formatUSD(newPrice);
                changeEl.innerText = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeEl.style.color = change >= 0 ? '#4ade80' : '#f87171';
                changeEl.style.borderColor = change >= 0 ? 'rgba(74, 222, 128, 0.2)' : 'rgba(248, 113, 113, 0.2)';
                changeEl.style.backgroundColor = change >= 0 ? 'rgba(74, 222, 128, 0.05)' : 'rgba(248, 113, 113, 0.05)';

                if (newPrice !== currentPrice) {
                    updateDerivedMetrics(newPrice);
                    if(currentVolUsd > 0) {
                        document.getElementById('t-vol-zec').innerText = formatCompact(currentVolUsd / newPrice);
                    }
                    currentPrice = newPrice;
                }
            };
            ws.onclose = () => setTimeout(initWebSocket, 3000);
        }

        function updateDerivedMetrics(price) {
            // Update Reward USD only if element exists
            const elReward = document.getElementById('reward-usd');
            if(elReward) elReward.innerText = formatUSD(1.5625 * price);
        }

        // --- FETCH DATA ---
        async function fetchData() {
            const btn = document.getElementById('refresh-btn');
            const icon = document.getElementById('refresh-icon');
            const toast = document.getElementById('error-toast');
            
            btn.disabled = true;
            icon.classList.add('inline-block', 'animate-spin-fast');
            toast.classList.add('hidden');

            try {
                const cgRes = await fetch(API_CG);
                if(cgRes.status === 429) throw new Error("Rate Limit: Waiting...");
                const cgData = await cgRes.json();
                updateMarketUI(cgData);

                try {
                    const bcRes = await fetch(API_BC);
                    if(!bcRes.ok) throw new Error("Blockchair blocked");
                    const bcJson = await bcRes.json();
                    updateNetworkUI(bcJson.data);
                } catch(e) {
                    updateNetworkUI({blocks: 2726000, difficulty: 85000000, hashrate_24h: 12800000000}, true);
                }

                const chartRes = await fetch(API_CG_CHART);
                if(chartRes.ok) {
                    const chartJson = await chartRes.json();
                    updateChart(chartJson.prices);
                }

            } catch(e) {
                document.getElementById('error-msg').innerText = e.message;
                toast.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                icon.classList.remove('inline-block', 'animate-spin-fast');
            }
        }

        function updateMarketUI(data) {
            const md = data.market_data;
            const p = md.current_price.usd;

            document.getElementById('t-high').innerText = formatUSD(md.high_24h.usd);
            document.getElementById('t-low').innerText = formatUSD(md.low_24h.usd);
            currentVolUsd = md.total_volume.usd;
            document.getElementById('t-vol-usd').innerText = formatCompact(currentVolUsd);
            document.getElementById('t-vol-zec').innerText = formatCompact(currentVolUsd / p);
            document.getElementById('t-ath').innerText = formatUSD(md.ath.usd);
            document.getElementById('t-mcap').innerText = formatCompact(md.market_cap.usd);
            document.getElementById('t-rank').innerText = "#" + md.market_cap_rank;
            document.getElementById('t-privacy').innerText = "29.4%";

            document.getElementById('circulating-supply').innerText = formatNum(md.circulating_supply);
            const mined = (md.circulating_supply / 21000000) * 100;
            document.getElementById('percentage-mined').innerText = mined.toFixed(1) + "%";
            document.getElementById('issuance-remaining').innerText = formatCompact(21000000 - md.circulating_supply);
        }

        function updateNetworkUI(data, isEst = false) {
            const blocks = data.blocks || 2726000;
            const diff = data.difficulty || 85000000;
            const hash = data.hashrate_24h || 12800000000;

            document.getElementById('block-height').innerText = formatNum(blocks);
            document.getElementById('sidebar-block').innerText = formatNum(blocks);
            document.getElementById('blocks-24h').innerText = isEst ? "~1,152" : data.blocks_24h;
            document.getElementById('difficulty').innerText = formatCompact(diff);
            document.getElementById('hashrate').innerText = (hash / 1000000000).toFixed(2) + " GSol/s";
        }

        function updateChart(prices) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const cleanData = prices.filter((_, i) => i % 3 === 0);
            const labels = cleanData.map(p => new Date(p[0]).toLocaleDateString());
            const data = cleanData.map(p => p[1]);

            if(mainChartInstance) mainChartInstance.destroy();

            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(245, 183, 0, 0.4)'); 
            gradient.addColorStop(1, 'rgba(245, 183, 0, 0)');

            mainChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        borderColor: '#F5B700',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#F5B700',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1a202c', titleColor: '#F5B700', bodyFont: {family: 'JetBrains Mono'} } },
                    scales: {
                        x: { display: false },
                        y: { position: 'right', grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#64748b', font: {family: 'JetBrains Mono', size: 10} } }
                    }
                }
            });
        }

        function renderShieldedChart() {
            if(shieldedChartInstance) return;
            const ctx = document.getElementById('shieldedChart').getContext('2d');
            shieldedChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2021', '2022', '2023', '2024', '2025'],
                    datasets: [{
                        label: '% Shielded Supply',
                        data: [5, 8, 15, 22, 29.4],
                        backgroundColor: '#F5B700',
                        borderRadius: 4,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#94a3b8' } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } }
                    }
                }
            });
        }

        initWebSocket();
        fetchData();
        setInterval(fetchData, 120000); 

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                item.classList.add('active');
                
                const target = item.dataset.target;
                document.getElementById('view-price').style.display = 'none';
                document.getElementById('view-shielded').style.display = 'none';
                document.getElementById('view-education').style.display = 'none';
                
                document.getElementById(target).style.display = 'block';
                
                if(target === 'view-shielded') renderShieldedChart();
            });
        });
        
        document.getElementById('refresh-btn').addEventListener('click', fetchData);
        document.getElementById('menu-toggle').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
        });

    </script>
</body>
</html>
